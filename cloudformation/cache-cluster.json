{
  "Resources": {
    "SecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "security group for only allow ip in 10.0.0.0/16 CIDR connect to cache cluster",
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "ToPort": 6379,
            "FromPort": 6379,
            "CidrIp": "10.0.0.0/16"
          }
        ],
        "VpcId": {
          "Fn::ImportValue": "TetrisVpc-VpcId"
        }
      }
    },
    "SubnetGroupForCacheCluster": {
      "Type": "AWS::ElastiCache::SubnetGroup",
      "Properties": {
        "CacheSubnetGroupName": "redis-cluster-subnet-group",
        "Description": "subnet group for redis cluster",
        "SubnetIds": [
          {
            "Fn::ImportValue": "TetrisVpc-Subnet3Id"
          },
          {
            "Fn::ImportValue": "TetrisVpc-Subnet4Id"
          }
        ]
      }
    },
    "CacheCluster": {
      "Type": "AWS::ElastiCache::CacheCluster",
      "Properties": {
        "ClusterName": "tetris-redis",
        "Engine": "redis",
        "NumCacheNodes": 1,
        "CacheNodeType": "cache.t3.micro",
        "CacheSubnetGroupName": {
          "Ref": "SubnetGroupForCacheCluster"
        },
        "VpcSecurityGroupIds": [
          {
            "Ref": "SecurityGroup"
          }
        ]
      }
    }
  },
  "Outputs": {
    "CacheClusterName": {
      "Value": {
        "Ref": "CacheCluster"
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-CacheCluster"
        }
      }
    },
    "CacheClusterAddress": {
      "Value": {
        "Fn::GetAtt": ["CacheCluster", "RedisEndpoint.Address"]
      },
      "Export": {
        "Name": {
          "Fn::Sub": "${AWS::StackName}-CacheClusterAddress"
        }
      }
    }
  }
}